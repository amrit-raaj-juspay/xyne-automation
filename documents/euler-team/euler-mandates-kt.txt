# Mandates Knowledge Transfer Guide

• **Mandate Registration Process**: Explains how subscription-based payments work (like Netflix/Amazon Prime) through mandate registration APIs, covering order creation with mandate flags (required/optional), payment method support (UPI, cards, wallets, net banking), and the difference between fixed vs variable mandate amounts.

• **Mandate Execution Workflow**: Details the complete execution flow including mandatory notification calls (sent 24 hours before recurring transactions per RBI guidelines), recurring transaction processing, different execution modes (instant vs scheduled workflows), and mandate sync operations for handling pending responses.

• **Advanced Features & Error Handling**: Covers retry/requeue mechanisms for failed transactions, retarget payment functionality (sending WhatsApp payment links when recurring fails), mandate lifecycle management (pause/resume/revoke operations), and comprehensive webhook notifications for merchants.

---

Okay. So, uh someone's okay. Um so, we have today is like mandate. So, can anyone say like what is mandate in uh real time. What uh in day-to-day life uh do we have mandate? Do do we use mandate somewhere?
So can you specify uh like on what app and what what do we do in that? Give a little idea about mandate.
As far as I knowable we'll be paying.
Okay. So, uh we have this uh feature where um as a suppose um I am the customer and I want a subscription in Netflix or Amazon Prime any uh app. So uh for the subscription thing we have this feature like where we can uh do the payments for mandates. So um the first thing we do there in the application is like register And then uh in the registration call what we do is like we uh do the payment. So for that we have a API called mandate register. Okay. So, uh I'll be sharing my screen. So, um a user will be creating uh we'll be creating a customer and the create custom customer API. Um everything is same. It's not like uh there's nothing uh with mandate call um mandate flag. Yeah, we'll use this uh customer ID and pass it. in order order id. Okay. So in um order API call we have this uh flag like u option create mandate. This has two uh values like required and optional. So required is like when we create a order this will be creating a mandatory it will be creating a mandate order and if it is like optional um at this point of time it will be a normal order. But while we create while we do a /tx in call uh if we pass there should create mandate true it will create a mandate transaction. So this is the difference. Okay. So um also we have this uh mandate start date and end date. So this is the as it um you know suggests this is the starting date of mandate and when the user can end the mandate. And um we also have a flag like uh um frequency uh frequency where we have like monthly uh as presented and weekly and also we have a lot of values there. So monthly uh like for example monthly we have is like uh whatever the user wants to uh want the wants the recurring transaction to be done how frequently the recurring transactions to be done. So if he is mentioning like monthly the recurring transactions will be done um monthly wise as presented like it's like u based on user what uh date he wants to have the recurring call okay
merchant will have the right
okay okay rule is also there I don't
so here mandate max amount so it should be all is greater than the order amount.
Okay.
So yeah this um yeah mandate max amount it's like if uh this is based amount uh based on two conditions. So it's like if it is u mand what is the rule
huh I forgot the rule variable it was Yes.
Okay. Shutting this.
Okay. So, in mandate uh this mandate max amount uh if it is fixed like uh we can Huh? As you can see this mandate max amount suppose I should uh so if this mandate max amount depends depends upon the two criterias here uh fixed and variable if the fix if the user has I mean merchant has set the value as fixed that particular amount will be debited only from the customer's account uh at the time of recurring call um when this value and when the rule type is set to variable um if in the variable type if we have set a value uh the amount as 100 the recurring call can be less than or equal to 100. So this is the like difference between uh amount rule as fixed or as variable. So by default we keep it as um variable
so um yeah so after creating the order ID. Uh we use this order and do a mandate registration. So in mandate registration we have uh all the payment methods uh starting from uh UPI card wallet and uh NB. NB is also called as uh enash where we pass amount as one. This is the basic difference. Uh in all the payment methods we can pass whatever amounts we want but in uh enash There has to be amount as one rupee only less than two rupees
third party.
Yeah.
Simb something.
We just moved on only these three.
Okay. So, as you can see, we have just this order ID and the usual curl. Um, also we here this flag will be there like mandate type as e-mandate and should create as true and uh after hitting this space start uh we'll be doing the registration and if uh we'll get a um transaction is charged as you can see this is the order status call if the transaction is charged in the in the order status API will have a mandid block okay so uh here she is doing with the e-manded flow whether we have mandate also so she's trying with the UPI transaction so if you want card means you can mark it as a mandate type is mandate
so then we have to give the card details card number CDV and yeah so it will go with the card flow either once this transaction is completed so we'll get the uh mandate I mean Once this transaction once we click the P start so we get the mandate ID right so after the mandate ID gateway also will send one unique mandate ID to us it will map it will map and mandate ID will be in act to state mand should be in active so we get that mandate ID in order status
yeah in the screen you can see I will show this is the mandate block if it is a mandate order we have we'll have a separate block in the order status where we'll have the status as active. Active means the registration is done done successfully and now the customer is eligible for mandate. Okay, the customer has given right for mandates. So um also this mandate ID will be using for further process like notification and recurring call and this is the same um the the format of this is e port I mean we use e port converter here. for the
huh huh
Unix.
Yeah.
Yeah.
Okay. Found variable. So the here we'll be using this mandate ID and hitting the notification call. Okay. So why do we do a notification call in mandate? So like for the user if he has done the registration first time registration and now u after that after if we want our subscription to be like continued. So, uh we'll be sending user a notification that okay for the subscript subscription to work um uh your amount will be debited on so and so date for certain amount. So for that user must must know uh and also he'll have a idea of on what date or what amount the money will get deducted. So for that we are sending a notification call.
It's RBA guidelines. Uh RBA wants the customer to know that you'll get like this amount will be deducted after 24 hours like after 24 uh it will be called one day before
one day before
before the uh recurring
recurring so customer can keep sufficient balance in his account so that recurring can happen correctly to reduce number of failovers also you can consider this
yeah
because insufficient fund error will happen right to reduce that it is like an intimation to the customer we are recuring is happening
a reminder call that uh to keep the in like sufficient balance.
Yeah. Balance.
Okay. So, uh if the notification call is success, uh we uh the user will get the message that okay on the so and so date uh the transaction will be uh debited and after that uh the su I mean the success notification call after 24 hours we'll be hitting the recurring call API. In this um we'll be passing the same mandate ID which we saw in the orders. status. Okay. And the same customer because for that uh why this um customer ID is important to have a link like u for this particular particular customer ID only we did the registration call. So to have a link for which mandate ID and for which customer we're doing this recurring call we're passing these values. Um okay. So and this notification ID we'll be using from the notification call. and everything is same. Okay.
Yeah. So, uh this if the scheduleuler is uh active for the merchant ID after 5 minutes of hitting this API, it will show whether the transaction has been uh success or failure. So, uh Siman, can you explain scheduleuler what it is and what it uh execute workflow how it happens? muted this recurring call. So we'll pass the order ID and payment methods and all we are not passing here. We are taking the mandate ID score. So um so told right uh so first so uh in order create call we'll pass whether the mandate is required or not I will share my screen So mandate uh for mandate it won't be different. So as she mentioned so we'll pass whether the mandate is required or optional in the order only. So the difference between required and option is if you mention uh mandate as required in the you know order create call then uh merchant is telling okay it is a uh mandatory it's a mandate order. So in the txn TX uh curl we need to mention the mandate type whether is it a mandate or e-mandate. If uh we given um mandate required mandate as option optional in the order create if we are not passing the know mandate type in the transaction call also it will work if we mentioned as required and if you're not passing the you know that mandate type in transaction it will throw error like um so mandate type is missing some error. So if you mention as optional you can do a normal transaction or a mandate like mandate transaction. So once the mandate got successful so now a customer is registered with the mandate so we'll get the ID and all uh now uh if you want to do the u recurring transaction there are two ways uh so we have two cuts one is um mandate workflow enable merchant if mandate is enabled if some merchant is enabled for that merchant one second let me Take what?
Dogs. How it has to write away. Okay. So we have I'm going to call mandate overflow something enabled merchant some is there are you good
it's fine only Okay, if it some merchant is enabled for this cut over then in recurring transaction usually in recurring transaction we have to pass the so why we do the notification call is uh we need that notification ID and we will use that notification ID in the recurring transaction. If some merchant is enabled for this one then we no need to pass the notification ID in the recurring transaction. Instead we can directly without passing the notification ID we can just hit the call and internally uh when when the tracker is created in when um the record is created in process tracker. So we will hit the notification call to the gateway and then it will go to either notification status. We have one more call called notification status. It is nothing but a notification sync. Uh this we will do usually for KTM V2. So for KTM V2 gateway when we do the notification call we won't get the status as success. We will get pending only. So we'll take that notification ID and we call again we call we have the notifications in call. We'll hit that and it will go to success. So based on the gateway uh whether we internally we will do the notification and notification sync call after that it will go to mandate execute mandate and in execute mandate uh sometimes when we got the pend other than success when we got the pending from the gateway then we will move to mandate status it's like a mandate sync internally we'll do that call and we we have one more cut over schedule from schedule level banded H. So first check is first uh we will check for this cut over if it is enabled. If it is this cut over is enabled also we won't see uh we will go to the like internally we will hit the notification and we so when this cut over is disabled and this is enabled then you have to pass name you we have how to hit the notification call manually and we need to take the ID and we need to use that ID in the recurring transaction and we need to proceed with the recurring mandate and uh if it is also false if it is also not enabled then it will go to the instant instant flow means uh after hitting the recurring transaction we won't create the tracker in the process tracker it we will directly hit the PG and we will get the response and we will show that in the order status that is the instant recurring
here notification ID.
Yeah, instant also we need notification ID. Uh so in all mandates we need notification except uh NB. So NB we no need to hit the notification. Why? Because for NB issuer only will handle the recurring transaction. So they only manually check. That's why if you want to do the recurring transaction for NB flow, it will take two to three times because they will do manually. So that's why except N For all PMS we payment methods we need to the notification and we need to pro to proceed with the no recurring transaction till now any queries. Okay cool and uh we have um two more flows like uh retry and recube. What what is retry means? Um so uh for two uh if any flow wants to go to a retry and recube flow we need to update uh that in the GSM which is nothing but gateway start um gateway status mapping DB so how we'll map this okay um so when we we uh done one recurring bandit transaction and instead of success we got some failure failure authorization failure and some failure got we got so we will take that and gateway will send some error code We will take that error code and error message. Uh to that we will map in the GSM table. We will map the uh status as retry failed something retry failed or recction on status the status as retry or retarget.
Yeah. Yeah. Retarget. So retry and rec. So what is the difference? So what retry means? Um so that's only so when retry is not enabled and recurring transaction got failed. Then order status we will mark as authorization fail and we won't again try for the you know recurring so we will mark it as fail. So if we enable uh retry means again if we it and retry count uh as of now in sandbox it is uh three. So when we enable the retry for that uh error code and error error message then when we got the failure message from the page we won't update the order status again it will be pending only again we will internally we will call the PG and like three times we will do the uh PG call and after three times if we got the failure then we will update the order status to some whatever response we got from the PG and in the process tracker it will be uh uh retry exceeded something retry added it will be so and rec also same thing so rec also uh will do the same thing but what is the difference between retry and rec is for retry Okay, every time we will create new tracker in the process tracker that means transaction UID will be new every time. So when once one retry got failed okay we will mark that as ret added and again we will create the one more tracker and we will call the PG like that uh like different uh track uh rows we will create in process tracker and rec means same uh row only we will update when whenever we are calling the PG
it will same
uh it will call the t same takes in u the pg and we'll update the same tracker there won't be any different tracker this is the difference between the retry and retarget sorry reflow rec
sync workflow no it's not mandate sync one no
yeah
that only so when we got pending response from the pg we will call the mandate sync internally
recurring transaction
in recurring transaction Yeah, in recurring only it will be mandate status for any mandate transaction.
Yeah. So in every recurring transaction um for all the recurring transaction we have mapped in GSM then that's only 12 will That's it from this one. You can tell the retarget the LSP. Okay. So they have come up with this new feature. retarget payment. So um for this first of all merchant need to give confirmation uh uh in dashboard. So we have a toggle button there enable a merchants for retarget. So why are we using this feature is like suppose our recurring call has failed due to some reasons like suppose the user had insufficient balance or um maybe due to some internet connectivity or um he was not able to um the transaction itself failed. Okay, invalid uh data or some error we got. So uh before sending this same like message to PG, we are trying uh to make it like we are trying to make the call three times. We uh we want to retarget the same transaction three times. So for that uh if the merchant has enabled this configuration in dashboard retarget payment. So if a recurring call is getting failed uh then we'll be receiving like three uh payment links on uh WhatsApp payment uh three payment links like uh it will be um in certain time uh interval uh so the customer who has like um in the customer customer API whatever number we have uh given the on the same uh number we'll be receiving those messages and customer will have a chance of uh you know making that payments again. So in the first call if he makes the transaction uh if he doesn't um you know click on the link itself then it will be pending. Then after suppose if we are getting the second message after 5 minutes we'll be getting a link. Suppose he tries the user tries to open the link and does the payment it will be uh and if he fails to do the payment it will go to fail. This is like for the first time it was retry count as one. For the second time it was retry count as two. Now we have total we have three counts. And for the third time if there uh the user tries to do the payment and uh he the payment has success. So the last um we also have a status like the last status whether those calls have um are pending. Pending as in um if the retra the the payment links are just opened and did nothing then it will be like the status will be pending if the user hasn't done uh anything on all the three links and u it will be like uh exhausted exhausted as in the payment links are consumed um if in the last link if the uh the user does it as success we'll mark the status as success so after some time uh some time we'll be sending the status to the PG that okay we have done this uh thing and whether it is exhausted or whe the last there there will be only two status it will be exhausted or success. Okay that's the uh two yeah two status we have here and then then we'll be sending this to here.
So like we are making the transaction to another payment method instead of whatever the payment method
yeah here um this is like we when we click on the link uh we We have like different payment methods UPI, bank, NV and wallet. So whatever payment mode the user wants to do uh they can uh initiate the payment with it's not specific like uh whatever we used in the registration we'll be using the same.
Anything you can use there's no like specific limitation.
No and uh no there's no limit limitation but for this uh uh whole scenario to replicate we need uh recurring uh transaction to be failed. This is the main criteria. If the recurring transaction is failed then only we can have this.
So when where are we passing that three times we need to send
they have u coded in that way that um they have
three times they are sending even they can uh um you know mention the time gap between the payment links between
Yeah. Yeah. So uh for testing purpose we get we get the links like in 5 minutes but real time I think it be in hours five or four hours so if the user is like suppose the user has u got all the three links okay so um as a human behavior if we click on the first link we'll be clicking clicking right so the first link will be expired okay why because like as soon as we will be receiving the new links. The earlier ones will be expiring. It will it will not be valid one. So if you get the first link and if we again get the second link, the first will be expired and the second will be active. So the user has to click on the second link and do the payment.
It's like are we creating new transaction for sale order?
No, it's the same no it's the same uh transaction ID for which for which We are retargeting it again.
So like the transaction will be failing and detail.
Yeah.
Like recurring video it will get failed.
So like we'll keep it as pending or we'll keep it as failed then we retargeted how
where in the recurring goal
uh recurring call fails right
will we update the D status to success or like fail or failing to what?
So in recurring call the state if the status is authorization field we'll get some message like for example insufficient balance we're getting the same me message we have mapped in uh GSM
and yeah and then for in the GSM table we'll check what is the action on status for that specific error message if the action on status is retargeted okay then we'll retarget and we'll get all the links
hm It will be authorization failed only.
Okay. For that recurring same recurring order ID is failed to mark as failed. So to be replyed status retarget uh I think it is failed only authorization period after
while the link is uh going on the status will be authorization failed
I'll confirm that as far as I know this is authorization failed and after the status
then it will change no after all the links first link second link
it will change to either fail or success
huh After the final call it will change in meanwhile the process it will be authorization field I'll confirm and
you are asking like after recurring call
during the receive recurring we'll do rec after some attempts it will get failed
once it's failed then only retry rec will see some status will decide what will be the next action based on action of status it will get retargeted at that time. So what will be the status there like that what status
when it will be that's why they have the start it shouldn't be so int demand it's depends on the merch So just pay and everything token I think it's actually
no it's not in the morning only I created one I haven't received the bonuses but I can check failed in the
uh for this order ID. screen is visible.
So for this for this order ID the status
what I remember it is authorization failed only in the meanwhile process
only
it works for PDM2 Yeah, we are.
So for this order ID which I'm showing on screen, um I had like Monica got messages on payment links and when she clicked it was not working. So huh it close it. any kind of mandate not just card like
uh firstly now they have implemented in mandate but I what I know is like for all type of this um concept will happen like all the failed transactions we'll be retargeting it okay so this is the order ID uh which I not able to see Share your screen.
I got it. I understood like marking status as authoriz.
Yeah,
you guys miss like web books.
We books incoming web books that was
also We will send the notification seed web hook to the merchant and fail web hook and when the mandate is created we will hit give the so when the transaction we hit the transaction the mandate will be in created status and we will share the mandate created web hook to the merchant and once it is transaction is completed based on the status we will share either the failed mandate failed activated and when the sometimes uh mandate will expire so that time we'll share the mandate expired and we have mandate pass and revoke also. So pass is nothing but so when uh you want to pass your mandate we have like um we'll hit the mandate pass it will be passed and uh revoke means it will be completely revoked and you have to again create your new mandate and if once the it got passed and we can resume also and then it will be uh move to active and pass we will uh do by you in By giving the start date and end time also we can just give some start date and end date and uh within that time period the mandate will be in passed once uh it after the 10 time it again move to you know active for resume also for resume also we'll give the start time that's it that's pretty much about mandis anyone have any queries No, just Yeah, see I'm passing.
Yeah, but order your If you pass pause, it will pause the mandate. That's it. That was access where you'll just post web book to pause the mandate. That's there was nothing there. He will mandate life is there. You can re it will take create, revoke or pause. Insert the pause. You need to it's like a command just to pause. So what are the status we will receive from first it is like if we have initiated a registration call we'll have a status like created okay if the registration call is success we'll have a status as active fired also.
