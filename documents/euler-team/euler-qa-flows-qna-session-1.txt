# Euler QA Flows Q&A Session 1

• **Testing Methodology & Best Practices**: Emphasizes the importance of testing both new features and existing flows to prevent regressions, focusing on comprehensive test case coverage and ensuring that newly added features don't break existing functionality.

• **Log Analysis & Debugging Techniques**: Covers detailed log checking practices including outgoing/incoming request validation, gateway response handling, webhook testing, mandatory sync concepts for security, and using Kibana logs with session IDs for comprehensive flow tracking.

• **Gateway Integration & Flow Types**: Explains different payment flows including callbacks vs webhooks for various gateways (UPI gateways rely on callbacks, others use webhooks), authentication concepts, producer-consumer architecture, and database operation tracking across payment transactions.

---

whatever feature additional feature new feature which you have added to the particular flow's existing so uh how do you want to test that let's say it is a new feature added to the existing flow okay so I want you to how you will test one is the new feature testing the other one is the existing close testing correct so lot of the test cases which we have seen right I mean like uh the bugs we got in the uh after uh the things got deployed all these things. So we are leaving this existing flows testing you are checking the feature yeah feature is working fine but that feature got affected to some other flows the existing flows that we are missing out this is what I wanted to point out from long time because the major bugs we are getting the newly added feature all these these sort of things some basic test cases getting missed some basic feature uh test test cases is not there this is not to point out anyone but it's like a basic test case you have to keep in mind every time whatever you test it right so you have to make sure key the existing features existing thing flows not breaking anywhere I don't care about the new feature as of now the existing flow shouldn't break new feature I think I have some kill switch or something that I can disable the feature but the flows wise whatever you are testing as of now that existing feature should work fine okay so that every time you when you test something just keep that in mind okay now Any questions on any particular flows? I mean like anyone can start. We can talk about some particular flow. I mean like whether it's a card or whether it's a PDX and anything particular flows you can we have a lot of flows right.
Is there any sheet that they have uh Okay.
Yes. I will share the Google sheet.
I've shared in the Google meet.
Okay. I haven't joined the Google.
Helping you bit. Ah, sure. Everyone uh used to see the locks. Everyone gets to know
one thing was uh basically I am not I'm uh very much confused in checking the logs. I mean what I need to check there are so many hits will be there. So particularly what I need to more focused on so that my time will be I mean I can save the time in checking all the things.
So So whenever you check the loss this is depends on the feature or the type of the testing you on what feature or what the boundary you are doing. Okay. So mostly the main basic log things everyone should check is like the request to the gateway that will be the outgoing request from the host service the source service to the gateway ideally that will be from the same service there are different things also whatever the gateways which are there in AP API gateway we will proxy to that and from API gateway we will send the outgoing request but mainly whatever the API TX and related things which are there so you have to check the outgoing request in the outgoing request I think you guys have the repos also API TX and repos right but more easier way of checking that whether it's a any of you are used to our APIs you know our APIs right so in the outgoing you'll see the gateway APIs actually okay if you are consu conf confused about the gateway API test you can go and check the particular gateway in the endpoints module file you will get the endpoint of the gateway what is the endpoint for testing environment what is the endpoint for production environment okay but ideally the gateway request if you want to check that will be a outgoing request okay outgoing request you are checking that is the one thing and the second thing once the request comes in right how we are handling handling the response basically so it might be a redirection thing or you will get a V2 pay response or you might be a web hook response sync response everything. So the handling of the response is also one thing you need to check very closely because in the request and response you have seen but whenever I'm consuming into my system there might be a type mismatch or there might be some value mismatches might happen. So one is you have to take care of these two things first thing and then if the change is made to our internal APIs any you will the internal API request whether the response is served or not that is the main thing
okay and we have the other things also sync scheduulus I mean like the guys have written scheduulus and this guy incoming webbook incoming webbooks sandbox you won't even get it for most of the gateways you don't even get the incoming webbook so there are some flows which you need to check the incoming webbooks you guys have to post the webbook posting the webbook in the sense from postman you are creating the gateways payload and hitting it from postman. Okay. So first for that the prerequisite is you have to get the gateway web book type. How the request will be on the gateway and the thing is like where you will get it. Can anyone tell where we can get it?
Correct.
Pro you have to take the pro uh while sample or if you go to the gateways documentation also some gateway specified uh how the web hook request will be and you have to hit that request to our internal v2/book/ uh id and then the gateway correct so you have to internally hit that and then you have to check this
yeah which API is involved in this where we uh decrypt this where we take this whole sample and use in our API which API it is called space/ webbooks that is the API right that is our web incoming webbook API this this webbook AP The gateway will always hit this. For gateway, it is static. Gateway will widely this URL at their end. Okay, that URL for that URL, they'll send the webbook request. So, ideally, V2/PL/Book/ URL is my URL. So, they'll hit that I'll give you the response. If the web hook is capture successfully consuming, I I'll give you webbook success captured. If the webbook is not uh consumed, then I'll give you a three or 400 or 500 based on the request type. Okay. So, and then in the web book the other thing is mandatory sync. Can anyone tell man? What is that man? Why it is used?
Why? Why don't you consume it directly?
Security reason. Anyone can post a book. Uh that security reason came for a reason, right? Security purpose came for a reason, right? Why? Because the book can be.
Yeah, sure. Why? That might have we have added for a reason, right? Why pay
how the pay can be changed.
If that can be changed, there is some loophole, right? If the payload can be changed there, what is that loophole? I'm asking the details of the gateway is actually failure towards the full market.
Huh, that's fine. Let's say I'm I think I'm a gateway. I'm posting it to just pay. Okay, I'll say that the this is my charged web hook. Okay, I'll sending it to just pay in between it can be changed. If that is that can be changed, there is some reason right there it can be changed. This we have told in the last last time also I mean like when we did this there might be some reason So okay let's say uh can I think of uh DOTP or some other API the space API how can I know that this is from this particular website they hit the /txns right and this we will say that this is from Reliance retail only or this is from sigi only how you will notice it how I'll get to know that this is from this particular merchant only 10 point point and
basically dop how we will know this is for this particular market authentication
correct right for webbook do we did you see any authentication
how do incoming webbook basically no right so whatever the APIs which comes from outside which doesn't have authentication right so what he has said is the most of the things are correct so this payload is an uh unauthenticated API unauthenticated API whenever it the request payload comes right request packet comes in so at that point of time it can be changed anywhere because it's an open open API so if you say charge to failure I don't even think it's failure if I comes to me if I don't have any validation I'll consume it I'll mark it to that transaction also I can mark it to failure so that is why the this mandatory sync concept came came in okay that is the one thing how exactly the mandator sync works So whenever the response we get it right from the web hook I'll not directly consume it I'll keep that instance at a side and then I'll check the type type of the particular request okay this is done and this is from this particular merchant and then I'll start syncing with the gateway this confix and all is there that is the second layer of check okay I'll check the config whether it is uh there or not then I'll start pulling the gateway for particular response. Okay, whether I got this charge response whether this is actually a charge transaction or not, whether it's correct or not, I'll send some request payload or mandatory sync. I'll actually the sync thing only. I'll send that and uh gateway will give me the latest uh status of the particular transaction. Then I'll okay this if that is also charged and this also I got the charge then I'll consume the web book and I'll update the status in my DB. Okay, this is one thing how you can check the web for log thing anyone who is doing it. Uh when you post the web hook, right? So there will be a outgoing request in that particular you have to check for the outgoing request because you think uh generalize that anything which is going out of my system is outgoing request coming into my system is incoming request and then based on the feature of Whatever the thing you are checking right you have to check the response end how we have handled the response if that is break in between you have to check the logs in between okay from this before this API this uh uh API got broke and I have to check before that flow we have currently we have that message number and all you can check based on that what is the message number the previous message numbers and post that message numbers you can check all these things
okay this is one one thing for checking the locks
so this uh mandator sync whatever we have discussed now. So when web hook returns me uh some data I mean charge up and uh failed or something. So I'm getting those order related queries from the web hook and then I'm
I'll get the you will get the payload in the webbook right this is a particular order
payload in the web hook basically we will fetch the tx take the txn ID we go to the tx and detail table we'll take the order id and tx and detail ID and then we will uh do a sync call uh from web hook it is like outgoing call to the gateway gateway will give you the response I'll fetch that response and I'll update the particular status whenever the thing sync comes mostly it is either the process tracker or either the tx and detail table ideally for sync you will use the tx and detail id right so then for pd that task gets created in the that is another thing scheduulus that is another thing for that checking that you can use the key name called as process tracker and update you will get the number of retries uh happened for the particular order and what is the recent status which I got if you take that session if you check it you'll get the gateway response for the particular uh thing also so basically the uh process ster ID you can take
so actually while we are checking we are hitting it manually I mean this
you are hitting it manually but whenever I'm saying like webbook when you are testing the web hook you have to post the webbook manually right
yeah
whenever at that point of time you'll make the outgoing outgoing call also if that is 200 success capture I will definitely making the call to the gateway if the mandatory sync is enabled for the gateway I'll making the call to the gateway gateway will give me a latest response for the transaction I'll consume it and then I'll process it yeah this is one thing
so while while we post the drive some gateways don't require hash pay you and
PTM has hash but it's not consuming so it's fine but for some gates they have this hash. So how do we bypass that?
For some gateways you cannot bypass that and TU and all whenever you do a transaction right if you do a inspect in the network tab you will get the out to the gateway they use nothing but the same hash used in you send in the transaction request
has that that sort of thing for Razer pay and all they have mandatory params for uh created time and then uh inside there is some par called notes and disable transaction at yourse two three params are mandatory at their site. So whenever you are posting that web right you you should make sure these things should be there
okay but some params right asking for hash some
huh that's what I'm saying for payu and all you can do that for some gateways you cannot bypass that you can uh you can't even either we can generate it from the script if the dev have the script you can generate it or else you can't bypass that Most of the gateways which we are having whatever the hash which we sent in the transaction call right that hash only you can use most of the gateway sends back that particular hash only
okay
huh huh for phone pay and all that's a B 64 encod you can decode it uh online and uh you can create the the book payload by according to their par whatever you got in the transaction response right according to that you can uh create the web. So it differs for different gateways. Some gateways you can bypass it. I mean like as you said PTM doesn't consume it and PM video in PTM we consume it in top up. The other flows we don't consume it. Uh PU as I said you can use a transaction payload hash it differs from the gateways. calls mainly we use for these gateway. So how do we get first which one will get first is an incoming call
that how that they will send you ideally this call backs will come first call back will update the transactions status
so where it gets
so call back we will consume it particularly whatever the UPA gateways mainly are there right for all the UP gateways these call backs are mandatory without call backs or a web response I mean like we don't usually sync because up and all when you do a transaction it should get charged right so you you want the end status so particularly all the this uh we will get the call back from the gateways gateways has their call back from the banks this underlying banks this is uh we have this PSP call back that is nothing but access calling their underlying gateway or a bank they will uh send it. It might be NPCA also if they they are acquirer and then NPCA call it NPCA they will give some response to us that first response is the call back ideally the call back will come first post the call back web I mean like it you cannot predict that ideal situation is this okay this is this but if the webbook comes also for if that is a valid uh webbook uh request I'll consume it
so we call back and using calling uh send that depends on the request right you might use some uh params it is not like the same uh this thing uh the call back request you
like we usually like how did you say like posting the we posted the call back right that's how like book got captured and the status got updated
uh v2 see call back the internal call back URL like if the v2/ space/ book that is also the receipt for me from the gateway saying that your transaction is success or failure. Call back which they have configured al that is also kind of received for me from the gateway. This is callbacks are mainly used for these UPI gateways the normal transaction which we do for a pay payu and all right we you will see only web books basically web books so both are the receipt from the gateway only the call back comes first I'll update my transaction based on the response if that is valid if this guy comes first I'll update if the based on the valid ideal situation is whenever you complete the transaction the call back will come first and then the web book won't
sandbox you won't get it I mean like
no
huh this is based on the their implementation most of the UPA gateways right ICI and we have that uh the what HSBC UPI
HTC HSBC HSBC UPI we used to have that uh VA feature but access UPI ICICIC UPI and uh recently migrated this thing HDFC UPI these all these mainly relies on callbacks
whatever the callbacks I said I mean like we don't don't even have the web hook concept at the those gateways okay so whatever the call back comes comes I'll rely on that particular response either the sync response you might have seen sometime the transaction might pending when you are doing some transactions right that might they might have sent the call back I often consume or it doesn't reach my system then I'll rely on the sync response if the call back they have sent me if that is reached it's a valid call back also we have to wait the UR there 200 only that is only that is the response uh for web capture right so for calls we don't have
for calls we should post it separately or even we have callbacks that itself will give because usually in in our case which we tested just like we used to post it right using post so then only we get that it is called boot capture
everything
so call back I mean like uh for lambda system right this is in a completely different system as said uh UPA gateways are in different system that call comes to lambda oiler aller will send to lambda lambda will process it then send it to oiler that was the process for these these services I mean like posting that in a postman is bit difficult only I mean like I'm not say it's easy because we have
generally
generally for uplace uh we don't ask you to post the call back ideally uh generally we don't unless and until there is a particular change which is affecting the call back of the particular gateway call back response of the gateway then only we'll ask you to test otherwise the UPA gateway it's fine okay because callbacks posting it if that is using the lambda system uh simulating it in particular postman or something that is but bit tricky because you have to make that URL gets whit listed you might have seen that uh internal UPA host or something that gets whit listed that will actually make the call from oiler to the lambda those URL white listing and that should be fine ideally that call back doesn't even come to sandbox only that call back always whatever the transaction if you do in uh sandbox also with production credential that call back will come to production gate you can check it by using that this guy if the URL is white I think now it is whit listed as of now whit listed if you want to do that you can take that production call back URL request is there If you can take that and you can post it here uh in postman.
So for posting the calls for web books we have
same
that is only so PHP call we have to add that PHP va extra pars otherwise the thing is same ideally those are all internal call right why I'm saying that this in production ideal scenario I'll do a trans transaction then after the transaction I'll get a call back that call back I'm not even posting it that's an internal call which is happening internally so that uh internal host will be there and then / PHP/ call back if you want to post it externally then the same URL/ that is all ideally the whole use case of callback and web hooks are same that functionality wise it is working is bit different for normal gateway it comes to oiler Oiler will process it. If the outgoing request I mean the mad addressing needs to be done that will be done for lambda use system oiler then lambda you will call lambda lambda system will process check it and send the response back to oiler then oiler will give you the actual end response for end user that is the Anything related to log?
Any doubts related to log or checking the response or something?
How we printing the starting from like a transaction like
huh how the logs gets printed sequence like okay
currently it's not sequential okay whatever you say like message one number one might be the first record of the session and message number two might be the somewhere in the middle. It's not sequential. You can do it
not sequential order
order is sequential and this guy also order and order status both for both the service it's sequential that can be done but that is with the data team I mean like whatever the log
huh indexing log that is with the data but whenever you want to check the log how you print it in the sense Whatever from the start of the session and to the end of the session okay the thing is like whatever the call which comes right the server might happening something in the server right if it's a SS call anything which comes to my system there might be happening in something so all these data will get captured in Kafka that is a pipeline which we have you might have heard right we are not not seeing that uh data in in the latency high and these things are happening and you're seeing that logs are not getting printed that is a pipeline which pushes the log. Okay, if that pipeline basically breaks then you might not see the logs after which it gets break. Okay, that pipeline will pushes uh pushes the log and they have the certain uh data processor and the revamping is done after that before that like uh when the data comes in okay this are the system related and then uh they will push the log to the particular application which they have received from whether it's then they'll send it to that is EC they'll send it to EC based on the different services but how the everyone knows how the routing happens you might have seen right okay this /dxns goes to APDXNS the other services goes to save method goes to predxn We don't know how the routing happens.
How the request comes?
We call it from we internally call the service, right?
Huh? You internally call the service but how the service gets decided where the request that is fine. The request comes in the deployment. You might have seen this but Huh? What does that mean?
So we have SQ that the uh you know where communicates command service communication happens and the rest is the higher level is a top level okay onward decides where to route the request to whether it's EC whether it's oiler whether it's some SDK thing whatever it is okay you might have seen that uh this easy migration happened right you Everyone heard like on all my whit listing has to be done. All white listing has to be done right. That particular white listing why we do is like that whit listing only done for particular EC service. That white listing was not done for the oiler application. Correct. Now if I whitelist that particular request then only this guy will come to okay. So now if you don't do that by default the EC got whitelisted. It'll go to EC. Correct. Now oiler got by list oiler. Once that is done comes to oiler. The second layer is STO will decide okay this is from this particular application and I have to check the VS to route that particular traffic. VS based on the routes /cards or uh this /cards balancer /xns where I have to route this traffic to. Okay. Then it'll route the traffic to particular service based on the virtual service that is where actually the primary key which will route you to particular service if I do /ds for some API order that will also work but the thing is like host name will be changed service name will be changed particular service happen routing happens via vs and the request comes at the request coming into the application that is based on online why And all this like you will heard this term but you should be knowing everyone is doing deployments right why the URL got mapped to wrong service or why the URL is not working all these things will come up that's why I'm telling this okay nothing related to logs are clear
so sequence wise first would be like how the logs would come in like trainer now we see lots of trainer sc the KV logs are different.
So how do we how do we differentiate
KV currently the if that is why
every so how do we test it like we are on a high level what are the things what are the law that we are supposed to look in.
See one thing you can do is like currently we have a tag process to KV or not that variable
huh that is enabled particular table okay if that is one thing uh you can check that whether it went via KV or not see if you are check if you want to check via logs uh I haven't seen the current logs which they have added for training did they add any logs for if the uh order gets drained to DV that previous plus
plus
no if it is drained to DV
no we have like process through KV and we have whether it got deleted or updated and
ah that that tags are there but when it gets trained
we have drainer logs
drainer logs
yeah but we won't we don't have any tag
we don't you don't have previously we used to have this Flush flush val I mean like if the flush happens that uh flu uh data flush to the DB successfully currently that after revamp if any error during the flush uh happens I mean like drain to DB while training to DB then we used to have that error logging there itself in the same thing currently this as she told update or this thing happened uh insert happened in KV or that thing you can check for trainer logs you can train log you can check if you go through the section Right? If you do a transaction in sandbox, if you go through the session, it'll drain immediately. So you can
like 30 seconds. So
you will get that log in the same session most probably in the same session. If that not if the drain happens after some time you will that will be in the another session where you will get the drainer logs complete drainer logs. That depends how the uh when the data got drained. So basically when this log comes into you call the decider that only when you initiate
for all customer order anything
everything so whatever they get KB is the concept when you come for whenever I have the high connection I don't want my DB to get disturbed
that's correct like for logging part for logs if you're doing the transaction so you will get uh the whole set like whatever you get whatever the tables enable for KV whatever the enabled K which gets trained for all these things I have the drainer locks if that when it gets drained everything is anything on KB sorry locks If we do any transaction, we check some blocks right like in some what are the specific is there anything specific you should check no TV most probably you need to check the types if the DB error comes in there might mostly be a type mismatch or something happened and uh the other error means that is depends on the flow wise how particular log has been written for my flow let's say I have written some flow and I have written some If some decode doesn't happen or some goes to some left case, I'll say that this is my log for that particular thing that depends on uh
mostly we focus on this like outgoing
incoming request, outgoing request and then the response handling
these three
uh and then the updation happened correctly or not. If that is done, I have consumed my response whether I have updated my DB correctly or not. All these things you need to check. It's not like incoming request and outgoing request but mainly the outgoing request is the where you call the gateway or call the other service from this particular thing I might call internally other service from this let's say SPM SPM will call lot of different services uh while giving the response from this particular service if I'm calling the other service so that will also be the outgoing request
from gateway
no SPM doesn't even call the gateway SPM is my API whenever the user loads the payment page I have to what are the options what are the safe cards what are the wallets what are the payment methods available I have these all the service is not there in PTXN from PDXN I'll call different service I'll call API cards I'll call API wallet I'll call I'll fetch that payment method API I'll call uh uh customers okay I'll call uh cards also I call
I mean that should come off For example, if that indicates
ah there will be out
everything you when you are doing that sequentially that will be a different service right you are hitting the customers and then going to order create so if you check the order create session you don't get the customer logs you'll get only the order create loss but SPM when you hit this right internally I'll going to call all these services I'll call cards I'll call AP wallet so
correct so after getting that response only from all these services I'll give you a response in the SPM particular API call right I'll give you the response that is what it is I mean like that will from this particular host service source service I'm calling different other services right that is also outgoing call for me you don't think like outgoing call is nothing but only call to a gateway whatever the internal call goes from this guy to this guy that is also one service to other service that is also outgoing call here the source call which API call which you are making right that is an incoming request
the sh method call which you are making right that is only the incoming request the other things which are all there right that I'm fetching from the different services so that is the outgoing request I mean like I this like don't be in a conception that uh outgoing request is only called to gateway it might be from one system to other system one service to other system service also that is So if we are receiving any incoming requests, so how we will get to know which DB it is affecting or where we are storing those data.
Okay, this this this I'll give you uh work uh do a order create call check the insert or create or update do a whole complete transaction or order creating customers and uh check what are the DB it's calling when you do order create what what are the DB it's affecting when you do a transaction what are the DB it's affecting
tables
I mean like tables sorry which are the table is inserting updating what are the queries is doing you can do this everyone can do this right one flow you like someone can take uh one transaction flow someone can can take wallet flows okay this I mean like the I don't want that sequentially sequentially also it would be better. But you can do what are the tables uh it is getting affected, which table it is getting called, which table it is updating, which table doing an insert, all these things.
So there can be some any kind of
400. Why we get 400? numbers would be there.
So out of that those many hits like when we want to search only for a DB uh logs is there any tag
for DB loss you can do it uh inside or you can do create insert uh all these things you can check with the or notation okay that will give you all the DB loss for the particular Find find might also will give you uh find all find one and uh insert we have and update update one update all these things. So like if you want to check that you can use these action DB action which is going to happen that that you can use it DB actions with our notation for the particular I would say ideal way is to filter it based on the error messages. not getting the error message then how we can check like some value has been updated uh so we will use the tag update
and uh with the session id uh will use to get the result
so suppose uh I have done a transaction and in the order status my my error message has been updated earlier it was xy z and now it is abc
so uh now you uh taking the session ID of / pxml and then how can I check my uh updated error message
for updation of error message there's something happened to
that particular uh
error message I need to verify both in the
yes one thing is like uh for updation of the error message for overwriting it something have happened right you have done something uh something would have happened right simply it doesn't update DB won't update right DB should get some connection from somewhere else some service is calling that particular DB that should update correct ideally you need to take that particular session let's say if you do did a some uh PT sync happened process tracker sync process tracker will override the error messages let's say XY Z to ABC okay that on the let's say on the third retract on the third sync it is uh overwriting the particular message let's say the transaction got charged okay so Now you have to go to the process tracker logs with the ID. I told you previous right that with the process tracker ID if it's put order ID and process tracker you will get the process tracker ids also
uh not TX and UID uh TX and UID also can be there and if you do simply order ID and process tracker you get the process tracker logs take the process tracker ID and update this will give you
process tracker ID I mean there will be a lot of results I mean okay with that order id whatever process tracker
that particular order id whatever the entries for process tracker if that is for normal uh refund you can uh check for the refund there there will be different task gets created for refund execute create uh refund sync okay then for uh transaction that normal uh transaction uh easy sync uh workflow something is there that ID that will be appended with this ID So if you take that and give you an update that will give you a different how many retries happened for session and when is the last retry happened ideally that last retrive updated your error message in your DB that's how you need to say so one my question is how do you differentiate between the express and redirection transaction
express have going to redction the form posting
we don't make API for redirection
there won't be any outgo from form posting we say only
that outgo we don't ideally we don't log as of now but ideally the data which went to the gateway that is for posting this are we getting those logs as of now
most of the gateways are reference to this if we disabled compost box
currently that is uh there logs those logs you can check that okay now you got these thing right how the S2S works and the these guys was S2S redirection transaction video/pres everything you will get it you will update the DB uh one more thing uh whenever you check the redirection response right video/pres Okay. Which are the flows which supports uh mandatory?
No, I'm saying the flows in this one is webbook flow.
What are the other flows? I'm asking at what the API which gets hits to me and then I'll uh do the mandatory like transaction
I'm saying mandated sync I'm saying is like I don't consume the response directly there is one more API
instead of consuming the response I'll do a sync to the gateway
just like
not PD just like mandatory syn when a web hook comes I'll do a mandatory right I'll call a gateway for later the same way I'll do that for one more API if you post this that is fine call back and web books are fine there one more API Sorry. Huh? There is one more API I mean like which does the mandate noting. I don't consume the response. Okay. I don't consume the direct gateway
API you are asking for that API from which we can get that API that's all
for web hooks we do but apart from think which are the services which update the status of the gateway I mean like transaction
posting that concept was there but what status is mind uh my API right
asking it is my API I'm checking the response from my DB and then I'm doing it whenever when you do the transaction some ABA will come uh pay response API V2 SP this is not enabled for all the gateways but uh there is one config called sync enabled gateways on redirection okay this API particularly this works similarly with what we have said right with the same thing that also we don't consume the response directly we will uh call the gateway with that particular session you can set the out request Okay. V2 pay responsible for
this is the gateway config only. So I'll enable some gateways. It's array of string. Whatever the gateways you want to enable for it for that uh you can enable it very similar. any question for this whatever until I told you everyone understood right
any questions
why we need I told right in the starting
specifically we Huh?
Huh? So, web hook is an unauthenticated API. So, whatever the request packet comes to me somewhere someone in the middle, he can uh change the failure to success, success to failure, anything.
Okay, let it be anything. Let's say the gateway has sent you the charge, but that guy changed to failure. Okay, I'll what I'll do I'll uh not consume it. I mean like I'll have that particular type I'll fetch the TS and d retail uh for that particular guy particular order uh then I'll uh do a sync call to the gateway so now the gateway the sync call is like authenticated call
so if only when the status is changed
no no no it's not like that whatever the whenever the web call comes to me I'll do a mandatory sync it's not like when the status is changed if that is charged I I'll do okay uh okay this is charged uh I'm not uh completely testing the webbook API I'll go do a mandator for that part
everything so the if the status is getting updated by web hook that will be most of the gateways are enabled for mandatory that will call a gateway gateway will give you the latest status let's say someone might have changed the amount from 1,000 rupees he changed it to 10,000 rupees. So I'll upgrade to 10,000. These are all the checks which we have in uh integrity check. We will see
without checking
uh without checking I'll just consume it. If you disable the mandatory
so once for one web call once so the thing is like if there's forcing doesn't even in the picture the forcing which they do right that is on the this crown sync that is previously we have the concept of crown sync we were running only chron this ping concept wasn't wasn't there so that crown for that ECR/ing gateway/ in the detail ID which you pass right that is a con so every 5 minutes or 10 minutes I used to run that chrome this is the API for that every transaction I used to face t I used to run that clock that used to give me a latest status then we came up with a concept called Once we only
what you want to trigger no it's not like that
it will take some specific time but for example
even if it is trans you can sync that that particular transaction either by force for forcing you can do or if that is in pending anyhow we have that process tracker sync right the process tracker will it will run in within the interval.
So that will some
uh that depends on the configuration that will run in between and that will f status.
Yeah.
Okay. For mandatory sync it is like uh once the web hook comes to me I'll don't consume that status directly. I'll call the gateway another time because this sync is like authenticated API. This will give me the correct response. No one manipulated. So I'll consume the response directly from the sync API.
So I haven't did the mandatory sync. So we can sync with any specific
no mandatory sync is nothing but whenever you uh webbook call right I told you webbook/pbook that request comes to me we will internally call that it is like you don't need to do anything you just post the webbook one internal call from that particular thing will be there for the gateway that is a sync call
okay
that will give me some response okay I'll consume that response and huh it's not only once one web book one time one one web book one time if the other webbook comes I'll do it another time that's all one webbook request I'll do a mandatory for one
huh correct
one more thing is why is /dx unauthenticated
you tell me
order order Mhm.
See there are some API authenticated also right?
Yeah.
Why that is authenticated? Why this is unauthenticated
there API which is authenticated right? The other API which is not authenticated.
This is also one one thing you guys have to check this why the /tx on redirection calls are unauthenticated.
If you this is a simple thing you can I mean like you can think and then this is also the other one is dotp because I have the other my other API authenticated right
just tell me why this is authenticated and /xs on redirection unauthenticated
okay this is two one is
flows for wallet and transaction calls which are the tables getting affected which are the tables getting updated inserted All these things you guys need to do. And this guy / xns is unauthenticated. And this guy is authenticated.
All right. Any doubts? Any question?
If you return it, then ask. We have a select. So both
entirely works. Okay. Can you tell me when you will get card?
Sometimes if not sometimes the president's
then
sometimes For example like uh some field should be enabled right I mean like uh uh direct so if the fees are not
what are all those actually
you told you told the answer right
I mean that is fine but but there is
ideally ideally there are two things whenever you are doing testing right you are enforcing the gateway ID right you'll pass the gateway ID that will ideally select that particular gateway ID if the payment method is not enabled it will give you a confine suitable gateway but ideally when you don't do a pass a gateway ID or gateway reference ID and you're doing particular transaction we'll filter based on uh different payment methods uh different flows all these things then first thing is like uh uh that order exactly I don't know I can check in the code I can tell but the thing is like it'll uh keep filtering based on the tn type and uh uh flows I mean like payment method which you are trying to and
example sometimes if I just pass the passing so that is done something so we take some priority and we take some other for example I want to I want to make a trans so like
one is like you can pass the gateway ID the second one is like you can pass the uh uh parity logic
add coke casp at the top level and do that
how that's what I'm saying so if you are passing not passing the gateway ID I'm checking based on the payment method type of the flow which you're checking txn type all these things then I'll start filtering the gateways and finally I'll give you one gateway okay this is the gateway which is out of those filter it'll take all the gateway which is configured for the uh particular merchant or payment method. Okay, from these things I'll filter out based on the payment method then ATX and type then EMI or uh anything else. All these things I'll just it'll keep on filtering and it's filter start filtering the gateway at the end you might have some one or two gateways and based on that this is the suitable gateway let's say uh two gateways are there one is PTM one is res out of that it'll give you the last gateway for the particular transaction type so So there inside that also we have some logics we have the elimination levels also one is like priority logic that if you don't pass priority logic I'll start checking for the particular gateway first one I'll take that
priority if I wanted to transaction using source I'm giving the priority logic as first priority is second source and third way
uh what should check like uh in what ways will take because the first priority logical right second is what I wanted to take it as
that depends on
tell them
huh so one
uh uh even like I asked this out to you before you said like gateway score we have and we have some uh other uh logics also it the decider checks for all these things and it after filtering all these gateways we get a gateways so But recently uh we got an issue on this side as a gateway for CV transaction observed out like even if though we give the priority logic as these gateways it checks like the gateways which doesn't have a gateway reference ID only as priority if there is three gateways
huh
like how
so gateway priority logic if you are given right that is like one is I don't even do a reference ID based check in the my log only EC doesn't do a reference ID based check. I'll do the checks based on transaction ID, payment method, txn type and which are the flow whether it's a EMI flow all these I'll do the checking based on these guys. So if uh you might have seen that even if you give the reference ID for particular flows without passing the gateway ID you try this once I mean like in sandbox I don't know but in the
we can give only ah get reference ID. It is not that it has to select that particular uh gateway only whatever the reference ID you pass. Okay, it will starts filtering based on the code logic. The code logic it is like it doesn't even uh filter first priority for everything is like only one ideal situation for that is only one gateway configured. Let's say go cash is only one gateway this guy is only one gateway but let's say if the non uh reference ID gate is not even there then it'll go for that particular check okay this pay is there I got how many pays some five pays are there okay my first priority is this guy so then it'll first thing is like non reference ID checks
it is the first check what it takes the non gateway reference
ah non gateway reference it is it is not a check but for the code is like code is written in such a way that uh don't consider a reference ID based routing for this get But it is like generally like
so this is like a change which is done like for past years.
Huh? It's like that it is like some four five years I guess. So it is like ideally code is that's what I'm saying. It is not a particular check which is filter filtering the g filtering the gateways. It is like it is the code is written as a check. priority give it to this first priority wise non-reference ID checks then this guy uh payment method types filters all these things txn type all these things I don't know the exact order but I mean like ideal way for priority is like non-reference ID gateways and then the txn uh type sorry payment methods then txn type all these things and EMI supported gateways or not and those things and then it'll finally build at the gateway. So gateway reference that if you're given also priority logic then there is certain elimination levels SR based elimination P method elimination P method type eliminations all these things that will say like that we have set some threshold let's say that that is also we have default config gateway scores everything so in that if the value is below that threshold let's say 7 is my threshold for one margin the transaction starts failing for this particular gateway like uh it went below that particular threshold 7. Uh you might have seen this log right penalizing gateway score and rewarding gateway score for particular gateway when you do a successful or final failure transactions right seen anyone seen you seen you sim you haven't seen that log penalizing gateway score rewarding gateway scores we have that particular log you will get your score and for for each each scoreization
if you check the EC logs you will get all this you'll get all this but whenever you do a transactions right after the successful or pay to transaction you you have had this log penalizing or rewarding the gateway scores so many of you came to me like uh the g I have given a priority logic for for this particular gateway and it is selecting the other gateway. The reason for that is this guy. So you might have failed the most of the transactions or someone else have failed that went below threshold. That is why it is not selecting the first gateway on the priority uh priority list. It is taking the second gateway next available gateway in the priority list.
Like is there any specific?
Sorry.
No. It's a it's like threshold score. I have defined some threshold. Let's say 7 I told right this is for example 7 is my threshold. If you start failing some 10 transaction I'll start penalizing the point. Okay. I'll start penalizing for every transa transaction failed. Okay. Then it went below 7. So when it went below 7 whenever I'm making for a new transa going for a new transaction at that point of time I'll take this guy. Okay. For this guy that's uh uh SR or gateway scoring is way below this guy. So I won't route to this particular gateway. This is depends on the payment that different uh level of elimination gateway elimination SR elimination all these things. Okay. If that goes below I'll start routing to another gateway that is what there are different levels of elimination payment method payment method everything that is based on that
and there is this flag right enable gateway reference ID based routing So how will that affect?
So that is a check for whether I can route a transaction for any reference ID based gateways in the particular merchant or not. If that is enabled then if you pass reference ID that will work.
No it's a merchant config. It's there in the merchant account table. So based on that it will start routing it.
Even though if it is enabled if we're not passing it uh those config I mean if we are not giving any reference ID and gateway ID
if the other PTM configured without any reference ID and that also work. So if you want to route it via this guy reference ID based gateway configured then you can use this guy you have this flash should be enabled.
So even in sandbox will it going to work without passing also will it those transactions will happen?
You can try you can try like without passing gateway ID gateway reference do some transactions but try particular payment method you will get some response. that might be some whatever the gateway configured based on that
decider is done logs are done for the and we have another option called like we use pass if I wanted to use tra use It doesn't get this call comes from front end
SDK people payment based call these those people use just pay gateway so ideally they pass that uh for routing to the particular they don't pass a gateway for Front end he doesn't know what the gateway is right what are the gateways confidence for the mer front end they don't know they know only the available payment method they know only the available uh uh payment methods and what are the flows we have supported that's all that is why the just payway reference just reference is also you can check that
so if we pass just any gateway reference it can be passed
any gateway what it's not like specific statement uh you can pass any gateway reference ID and you pass the gateway ID also gateway reference ID also do a trans try a transaction for that it'll go to particular uh gateway or whatever the reference ID which you have passed
is it necessary at that time to give G ID
no but why I'm saying this is like G front end will call this guy just pay gateway reference that is you might have seen for one of the flows they will uh for all the flows they'll start passing only one gateway referencing it is like front end they from the merchant SDK payload they are giving that all flows route to this guy the other flow route to this guy but the my front end doesn't know just front end doesn't know what are the gateway configured in the back end so they'll just send that payload to me I'll start filtering it out based on the all these things what I told you before right mention type this thing ideally from the back end side we will used to pass it like no none of the merchant will pass gateway metadata gateway reference ID everyone will pass just pay only everything whichever you check the request right everything come comes as just pay only how does the actual get the decide based on that only everything whatever the transaction response you get that is based on after the decider One is close rate which flows tell me close I want someone as this DV update right updates
I have already used for DV Same thing I have
but uh okay you write wallet flows be
and you have to write the / txs redirect and you have to write uh wallet direct transactions
no no you for particular flow whichever the DB table I'm calling what what is the action I mean like whether it's update whether it's a fine
action.
If I'm creating a customer, I'll insert to the customer table. Correct?
Uh so that is an insert call to the customer table. Same way if I call the /tx, there might be some insert to some table some uh update to some table uh fetch from some table. Fine. Fine. Call from some table that I need to you do for wallet direct debit. Okay. And uh you're doing for this guy uh you do for all the wallet flows create wallet to dealink wallet all these flows you redirection transaction and uh you can do forp flows
and you can do for use tested mandate right you can do for mandate
you can Mandator is the same thing. Uh
notification is there.
Notification that is only one call, right?
Split split payment or split settlement. Split settlement. Do we have credits?
Yeah. CCM Okay, you do uh SPM if you call the save method whatever the services it calling and whatever the DB is checking any anything It will do same thing.
And
the other list API can give response and pay response and refund refunds. status.
PT PT or
call can do PT. Okay.
Will come on separate or he can do the refund PT. He can do the transaction. That thing Sorry. If you check one flow, I want to check what the DB you call do for uh STM only. Almost doing verify. Where is next? that we have a video. We can share that video. before next session we can discuss this kind of a homework type
maybe tomorrow day after tomorrow before session we can discuss this better like if we maintain a sheet what we have done today and it's like even better like if they have any doubt they can put it in sheets and what they are expecting next session so that we don't want to bring up concept by so we have
already have a sheet like this
you have a sheet
you have a sheet I have shared it. Uh
I have that shared.
Sure. Sure.
I share that in our group. Uh
I've already shared in that group also.
Uh so basically of that sheet was key writing any specific question which they have about a particular flow. Entireity of the flow cannot be like taught or like cannot be discussed in a call or so.
Maybe if someone has to need to understand a particular flow they can directly that separately
shisha also
that would be fine but basic top level questions they can ask here
huh basic top level questions and any specific questions as well.
Ah sure then we can stop thanks
thank you

